#! /usr/bin/env perl

use Language::Learner::Common;
use Mojo::UserAgent;
use Mojo::File qw/path/;
use Mojo::Util qw/encode/;

my $ua = Mojo::UserAgent->new( max_redirects => 5 );

use Pry;
for my $word (@ARGV) {
  my $res = $ua->get("https://www.google.com/search?tbm=isch&hl=pt-BR&q=$word")->res;
  my $table = $res->dom->find('td img')->map('parent')
    ->map( sub { $_->wrap_content('<div></div>') });
  shift $table->@*;

  path("$word.html")->spurt(
    $res->body
    #encode 'UTF-8', '<div style="display: flex;flex-direction: row;flex-wrap: wrap">' 
    #. $table->map('to_string')->join('')
    #. '</div>'
  )

}

